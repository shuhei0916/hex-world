# todo

- [ ] リファクタリング
	- [ ] グリッド設定の一元化（今回は見送り）
		- [ ] `GridConfig` クラス（またはシングルトン）を作成し、`Layout` の向きとサイズを定義する
		- [ ] `GridManager` が `GridConfig` を参照するように修正する
		- [ ] `Piece` が `GridConfig` を参照するように修正し、描画ロジックの重複を排除する
	- [x] `TetrahexShapes` のリネーム
		- [x] `TetrahexShapes` -> `PieceShapes` にリネーム（ファイル名、クラス名）
		- [x] 参照箇所の修正 (`Piece`, `GridManager`, テストコード等)
	- [x] テストコードの改善
		- [x] `test_piece.gd` 内の `TestPortConnections` で `input_ports` を直接操作している箇所の修正（テスト用ピースタイプを使用）
		- [x] `test_piece.gd` のアサーション過多なテストの分割

- [ ] 単純加工プロセスの実装 (鉄鉱石 -> 鉄板)
	- [ ] レシピデータの構造化
		- [ ] `Recipe` クラス（または辞書構造）を定義し、入力アイテム、出力アイテム、所要時間を管理できるようにする
		- [ ] テスト: レシピデータから期待通りの出力と時間が取得できることを確認
	- [ ] 加工機能の実装 (Smelter/Assembler共通ロジック)
		- [ ] `Piece` クラスに「現在のレシピ」と「加工進捗」を持たせる
		- [ ] `tick` 内で、入力アイテムがあれば消費し、所要時間経過後に出力アイテムを生成するロジックを実装
		- [ ] テスト: アイテムAを投入すると、一定時間後にアイテムBがインベントリに追加されることを確認（単体テスト）
	- [ ] 精錬機 (Smelter) の設定
		- [ ] `WORM` ピースを精錬機とし、入出力ポートと「鉄鉱石 -> 鉄インゴット」のレシピを設定する
		- [ ] テスト: `WORM` ピースが鉄鉱石を受け入れ、鉄インゴットを出力ポートから排出することを確認
	- [ ] 製作機 (Assembler) の設定
		- [ ] `PROPELLER` ピースを製作機とし、入出力ポートと「鉄インゴット -> 鉄板」のレシピを設定する
		- [ ] テスト: `PROPELLER` ピースが鉄インゴットを受け入れ、鉄板を排出することを確認
	- [ ] 統合テスト (ライン稼働確認)
		- [ ] `BAR`(採掘) -> `WORM`(精錬) -> `PROPELLER`(製作) -> `CHEST`(格納) を接続して配置し、最終的にチェストに鉄板が格納されることを確認

- [ ] ピースの実体化（Pieceノードの導入）
	- [x] Pieceクラスは初期化データを受け取り、タイプと座標を保持できる
	- [x] place_piece()が呼ばれると、Pieceノードが生成されシーンに追加される
	- [x] place_piece()で生成されたPieceノードは、正しい座標に配置される
	- [x] remove_piece_at()が呼ばれると、対象のPieceノードがqueue_freeされる
	- [x] remove_piece_at()が呼ばれると、GridManagerの内部管理マップからPieceが削除される

- [ ] Pieceの機能拡張
	- [x] Pieceはインベントリを持ち、アイテムを追加・取得できる
	- [x] Piece上にインベントリ数を表示するUIが表示される
	- [x] Pieceは時間経過(tick)で状態を更新できる

- [ ] 入出力ポートシステムの導入
	- [x] ポート定義のデータ構造の実装
		- [x] `Piece` クラスに、自身の入出力ポート情報を保持する仕組みを追加する (入力ポートリスト、出力ポートリスト)
		- [x] デフォルトでは入出力ポートは「空（接続不可）」とする
		- [x] 既存のピース（BAR, CHEST等）に対して、暫定的に「全方向接続可能」等の適切な初期ポート定義を追加する（テストを通すため）
	- [ ] 接続性の検証ロジックの実装
		- [x] 2つのピースが隣接しているとき、互いのポートが「対面」かつ「入出力ペア（出力->入力）」になっているか判定する
	- [x] 回転への対応
		- [x] ピース回転時に、保持しているポート定義（座標と方向）も正しく回転される
	- [x] 輸送ロジックの更新
		- [x] `_push_items_to_neighbors` を更新し、接続性が確認されたポート間でのみアイテム移動を行うように制限する
	- [ ] ポートの可視化
		- [ ] 入力ポート、出力ポートの位置と向きを示す矢印（またはインジケータ）をピース上に表示する
- [ ] ピース操作の改善 (shapezスタイル)
	- [x] 右クリックによるピース選択解除
		- [x] ピースを選択しているとき、右クリックを押すと選択が解除される（パレットの選択インデックスが-1になる）
	- [x] 素手状態での右クリックによるピース削除
		- [x] ピースを選択していない（素手）とき、配置済みのピース上で右クリックを押すと, そのピースが削除される
		- [x] ピースを選択しているとき、右クリックを押してもピースの削除は行われない（解除が優先される）

- [ ] アイテム輸送の基本実装
	- [x] 新規ピースタイプ: SimpleChest (1マス, 貯めるだけ) の追加
	- [x] GridManager: 指定したHexの隣接HexにあるPieceを取得できる
	- [x] Piece: 隣接する受け入れ可能なピースへアイテムを自動的に移動する（Push型）
	- [x] 統合テスト: 生産者から隣接する消費者へアイテムが移動することを確認

## 将来的なタスク
- [ ] PaletteUI を Toolbar にリネームする

## メモなど（AIはこれを編集・削除しないでください）
- [ ] 回転ロジックのコードレビュー、重心の変更
- [ ] pallette uiをhexfrvrによせる。
- [ ] マウスオーバーでピースの詳細情報ラベルが表示される
