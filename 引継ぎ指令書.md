# 引継ぎ指令書

## プロジェクト状況
- **現在の日付**: 2026-01-17 (セッション完了)
- **完了したマイルストーン**: 
	- **インベントリの分離**: `input_inventory` と `output_inventory` を導入し、加工前の材料が勝手に搬出される「素通り問題」を根本解決。
	- **Input制約の緩和**: ピースのどのヘックスからでもアイテムを受け入れ可能に変更。パズル性を「Outputの制御（どこに届けるか）」に集中させた。
	- **施設情報の常時可視化**: 
		- `ItemDB` (Autoload) によるアイテムアイコン管理の導入。
		- ピース上にアイテムアイコン、数量ラベル（右下）、プログレスバーを実装。
	- **コードクリーンアップ**: 不要になったInputポート定義やハイライトロジックを削除。

## 解決済みの課題
- **加工アイテムの素通り問題**: インベントリ分離により、`output_inventory` にある完成品のみが搬出対象となるよう修正済み。
- **UIの視認性**: テキスト表示を廃止し、アイコンとゲージによる直感的な表示へ移行。

## 次に取り組むべきタスク (Next Steps)

### 1. 密度パズル要素の強化
- コンベアがない制約を活かすため、マップ形状を不格好に制限したり、ピースの形状をより「パズル的（組み合わせにくい形）」に調整することを検討する。
- `PieceShapes.gd` での形状定義の追加・調整。

### 2. アイテム移動のアニメーション
- 現在、アイテムはピースからピースへ瞬間移動しているように見える。
- ピース内部をアイテムが通過する視覚的な演出（スプライトの移動など）を追加し、「流れ」を可視化する。

### 3. UI/UXのさらなる改善
- マウスオーバーによる詳細情報のツールチップ表示。
- レシピ選択や施設の詳細設定を行うためのUI（現在は固定レシピ）。

## 技術的メモ
- **ItemDB**: `res://scenes/utils/item_db.gd` に定義。Autoloadとして登録されており、`ItemDB.get_item(id)` で定義を取得可能。アイコン画像は `res://assets/items/` に配置。
- **Piece可視化**: `Piece.tscn` の `StatusIcon` と `CraftingProgressBar` で制御。ロジックは `Piece.gd` の `_update_visuals()` に集約。
- **Linter/Formatter**: 引き続き `pre-commit` を使用。行長制限（100文字）に注意。